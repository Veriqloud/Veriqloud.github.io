<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Qasmat documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">3.</strong> Configuration</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="qasmat.html"><strong aria-hidden="true">4.</strong> What is Qasmat ?</a></li><li class="chapter-item expanded "><a href="shamir.html"><strong aria-hidden="true">5.</strong> The maths behind</a></li><li class="chapter-item expanded "><a href="file.html"><strong aria-hidden="true">6.</strong> Journey of a file</a></li><li class="chapter-item expanded "><a href="security/index.html"><strong aria-hidden="true">7.</strong> Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="security/at_rest.html"><strong aria-hidden="true">7.1.</strong> At rest</a></li></ol></li><li class="chapter-item expanded "><a href="api/index.html"><strong aria-hidden="true">8.</strong> API</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Qasmat documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Welcome to the documentation site for our Secure Storage Software : Qasmat.</p>
<p>This documentation provides information on how to install and  use the software along with explanations on its security features and how it works.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p><strong>To be modified depending on what we will give to the user</strong></p>
<p><strong>Add the possibility to give the configuration file</strong></p>
<p>You can generate the docker image of <code>proxy_server</code> or <code>storage_server</code> with the <code>Dockerfile</code> provided.
make sure that you are in <code>LINCOS</code> folder, where the <code>Dockerfile</code> can be found. Make sure that <a href="https://docs.docker.com/engine/install/">Docker Engine</a> is installed on your machine.</p>
<ol>
<li>Start ssh agent and load your private key.</li>
</ol>
<pre><code class="language-shell">eval $(ssh-agent)
ssh-add ~/.ssh/id_rsa
</code></pre>
<ol start="2">
<li>Build docker image with the desired arguments. Allow some time, the project will be compiled too. <code>proxy-server-test</code> is the name of the image.</li>
</ol>
<pre><code class="language-shell">docker buildx build -t proxy-server-test --progress=plain --build-arg="SERVER=proxy_server" --build-arg="PLAYER=Alice" --build-arg="SFLAG=" --build-arg="SNAME=" --ssh default=$SSH_AUTH_SOCK .
</code></pre>
<ol start="3">
<li>Run image in a container. <code>proxy</code> is the name of the container.</li>
</ol>
<pre><code class="language-shell">docker run -it --rm --name proxy proxy-server-test 
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>Each server (proxy or storage) can be launched with the configuration by default or a custom one.</p>
<h3 id="default-values"><a class="header" href="#default-values">Default values</a></h3>
<p>Here are the default values :</p>
<ul>
<li>discovery : local</li>
<li>network security : public</li>
<li>encryption_and_kms : None</li>
<li>web port : fixed 3000</li>
<li>web address : 0.0.0.0</li>
<li>max file size : 52428800 bytes (50 MiB)</li>
<li>allowed cors origins : * (allow everything)</li>
<li>checking_interval: 1 day</li>
<li>renewal_duration: 15 days</li>
<li>expiry_duration: 30 days</li>
<li>proxy_reconnection_interval: 30 seconds</li>
</ul>
<p>However it is possible to write a custom configuration.</p>
<h3 id="proxy"><a class="header" href="#proxy">Proxy</a></h3>
<pre><code>{
	"discovery_mode":"Local" or {"Remote": {"proxy_port": &lt;port&gt;}},
	"network_security_configuration":{
		"network_security":"Public" or {"Private":{"path_to_preshared_key":"&lt;path to key&gt;"}},
		"encryption_and_kms": (optional) ["AES" or "OTP", "address":"&lt;address of the kms&gt;","port":&lt;port of the kms&gt;]
	},
	"web_configuration":{
		"bind_port":{"bind_port":{"Fixed":&lt;port&gt;} or "Auto"},
		"bind_address":"&lt;address&gt;",
		"max_file_size": &lt;positive number&gt;,
        	"allowed_cors_origins": ["*" or &lt;list of allowed origins&gt;]
	},
	"time_keeper_configuration": {
		"checking_interval": {"secs":&lt;number of seconds&gt;,"nanos":0},
		"renewal_duration": {"secs":&lt;number of seconds&gt;,"nanos":0},
		"expiry_duration":{"secs":&lt;number of seconds&gt;,"nanos":0}
	}
}
</code></pre>
<h3 id="storage"><a class="header" href="#storage">Storage</a></h3>
<pre><code>{
	"discovery_mode":"Local" or {"Remote": {"proxy_address": "&lt;address&gt;", "proxy_port": &lt;port&gt;}},
	"network_security_configuration":{
		"network_security":"Public" or {"Private":{"path_to_preshared_key":"&lt;path to key&gt;"}},
		"encryption_and_kms": (optional) ["AES" or "OTP", "address":"&lt;address of the kms&gt;","port":&lt;port of the kms&gt;]
	},
	"proxy_reconnection_interval": &lt;number of seconds&gt;
}
</code></pre>
<h3 id="value-descriptions"><a class="header" href="#value-descriptions">Value descriptions</a></h3>
<p>The pre-shared key is 32 bytes of random data written in base16.
Can be produced with <code>openssl rand -hex 32</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-qasmat-"><a class="header" href="#what-is-qasmat-">What is Qasmat ?</a></h1>
<p>Qasmat is a distributed secure storage software. It is based on the protocol Lincos itself based on Shamir's secret sharing scheme.</p>
<p>Shamir's Secret Sharing is a cryptographic method that allows a secret to be divided into multiple shares. The secret can only be reconstructed when a certain number of these shares are combined together. This is done by creating a polynomial where the secret is a point on the graph, and shares are other points. To reconstruct the secret, a minimum number of shares are used to recreate the polynomial thanks to Lagrange's interpolation. This method ensures security as long as the number of shares combined is less than the threshold.</p>
<p>Lincos is a protocol which includes a secret sharing scheme such as Shamir's which ensure confidentiality of data at rest. The protocol also describes how to manage confidentiality in transit, integrity and authentication to achieve long-term unconditional security.</p>
<p>Finally, Qasmat is an implementation of this protocol in Rust. It is composed of two programs :</p>
<ul>
<li>The proxy : It interacts with the user via its <a href="../api">API</a>, implement Shamir and Lagrange's algorithms, handles integrity proofs, etc.</li>
<li>The storage : They respond to requests coming from the proxy server by storing or retrieving shares in their database.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-math-behind"><a class="header" href="#the-math-behind">The math behind</a></h1>
<p>Imagine having to draw a line passing through one point, there is an infinity of possibilities for that line. However, if two distinct points are required, one and only one line is now possible. This very simple idea is at the heart of Shamir's secret sharing and Lagrange's interpolation around which Qasmat is built.</p>
<p>The line is replaced by a polynomial of degree <em>k-1</em> whose value in zero is the secret to protect and other coefficients are chosen randomly. Then at least <em>k</em> distinct points of this polynomial are distributed on distant servers.</p>
<p>To recover the secret, at least <em>k</em> points of the polynomial are retrieved from different servers and the polynomial is built with Lagrange's interpolation (<a href="https://jsxgraph.uni-bayreuth.de/wiki/index.php/Lagrange_interpolation">visualization here</a>). Finally, <em>P(0)</em> is calculated which correspond to the secret.</p>
<p><img src="images/shamir.png" alt="Shamir" /></p>
<p>The number of points distributed (<em>n</em>) must be greater than <em>k</em>. Both values constitute a threshold <em>(k,n)</em> whose value is determined according to the security required (see <a href="../security/at_rest.html">Security at rest</a>).</p>
<p>Last thing : because coefficients are integer, everything is modular. The modulus is a prime number which avoid some <a href="https://en.wikipedia.org/wiki/Shamir&#x27;s_secret_sharing#Problem_of_using_integer_arithmetic">basic attacks</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="journey-of-a-file"><a class="header" href="#journey-of-a-file">Journey of a file</a></h1>
<p>First, the file is sent via HTTP/HTTPS from the user's browser to the proxy server. Then, because of the modulus in all the calculations, the file is split into chunks of size smaller than the modulus : the parts.
Each part goes through Shamir: <em>n</em> shares are produced. When enough shares are ready to be sent to a specific storage, the communication module trigger a request-response exchange with the storage server.</p>
<pre><code>+----------------+                                                              
|                |                                                              
| User's browser |                                                              
|                |                                                              
+---------+------+                                               +-------------+
          |                                                      |             |
          |HTTP/HTTPS                                            |  Storage 1  |
       +--+--------------------------------------------------+   |             |
       |  |               Proxy server                       |   +------^------+
       |  |                                      +---------+ |          |       
       |  |                         Share 1,1    |Share 1,1| |          |       
       |  |               +-------&gt; ...          |...      +-+----------+       
       |  v               |         Share 1,n    |Share p,1| |       +-------------+
       |               Part 1                    +---------+ |       |             |
       | File ------&gt;  ...                           ...    -+-------&gt; Storage ... |
       |               Part p                    +---------+ |       |             |
       |                  |         Share p,1    |Share 1,n| |       +-------------+
       |                  +-------&gt; ...          |...      +-+----------+        
       |                            Share p,n    |Share p,n| |          |        
       |                                         +---------+ |          |        
       |                                                     |   +------v------+ 
       +-----------------------------------------------------+   |             | 
                                                                 |  Storage p  | 
                                                                 |             | 
                                                                 +-------------+ 
</code></pre>
<p>Once all part are handled, a description of the file is stored on the proxy server with all required information.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="security"><a class="header" href="#security">Security</a></h1>
<p><strong>Add security in transit</strong></p>
<p>The following chapters present the security features of the software.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="at-rest"><a class="header" href="#at-rest">At rest</a></h1>
<p>The secret file is distributed over the network of storage servers with a threshold <em>(k,n)</em> :</p>
<ul>
<li><em>k</em> : the number of shares required to rebuild the secret</li>
<li><em>n</em> : the number of shares distributed (<em>&gt;=k</em>)
This threshold offers two main security features :</li>
</ul>
<h2 id="redundancy"><a class="header" href="#redundancy">Redundancy</a></h2>
<p>Because <em>n</em> can be greater than <em>k</em>, a secret can be retrieve even if some storage servers are unavailable.
For example a secret stored with threshold <em>(3,5)</em> : the information of only 3 servers is required which means that if 2 servers are unavailable, the secret can still be reconstructed !</p>
<h2 id="confidentiality-against-mobile-adversary"><a class="header" href="#confidentiality-against-mobile-adversary">Confidentiality against mobile adversary</a></h2>
<p>The threat here is an adversary that gains access to less than <em>k</em> storage servers in a given time. The scheme ensure that it will get no information about the file in this given time. The shares are renewed on a regular basis to avoid the adversary to gain access to more than <em>k</em> servers and thus be able to retrieve the file.
For example if a secret is stored with threshold <em>(3,5)</em>, an adversary reading the content of 2 storage servers won't have any information on the secret file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="api"><a class="header" href="#api">API</a></h1>
<p>The communication between the user and the proxy server is done through this REST API. It is specified like this :</p>
<div class="table-wrapper"><table><thead><tr><th>Endpoint</th><th>Request type</th><th>Fields to supply (if any)</th><th>Description</th><th>Response type (see skeleton below)</th></tr></thead><tbody>
<tr><td>/api/storage</td><td>GET</td><td>None</td><td>Returns the list of connected storage servers</td><td>servers: String[]</td></tr>
<tr><td>/api/file</td><td>GET</td><td>None</td><td>Returns the list of currently protected files</td><td>files: File[]</td></tr>
<tr><td>/api/file/protect</td><td>POST</td><td>- <code>threshold</code> (<em>number</em>): number of parts<br/>- <code>file</code> (<em>file</em>): the file to protect</td><td>Protects a file</td><td>null</td></tr>
<tr><td>/api/file/retrieve</td><td>POST</td><td>- <code>name</code> (<em>string</em>): the filename</td><td>Retrieves a file</td><td>File data as a stream of bytes</td></tr>
<tr><td>/api/file/remove</td><td>POST</td><td>- <code>name</code> (<em>string</em>): the filename</td><td>Removes a file</td><td>null</td></tr>
</tbody></table>
</div>
<h4 id="json-response-skeletons-"><a class="header" href="#json-response-skeletons-">JSON response skeletons :</a></h4>
<h5 id="valid-except-for-apifileretrieve"><a class="header" href="#valid-except-for-apifileretrieve">Valid (except for <code>/api/file/retrieve</code>)</a></h5>
<pre><code>{
  "code": number,
  "status": "string",
  "data": any // depends on the request, see Response type in the tab
}
</code></pre>
<h4 id="invalid-error-"><a class="header" href="#invalid-error-">Invalid, error, ...</a></h4>
<pre><code>{
  "code": number,
  "status": "error",
  "message": string
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
